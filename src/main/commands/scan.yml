description: Detect bugs and vulnerabilities
parameters:
  os:
    default: linux
    enum:
    - linux
    - macosx
    type: enum
steps:
  - run:
      name: SonarCloud
      command: |
        set -e
        VERSION=${SONAR_SCANNER_VERSION:-4.1.0.1829}
        OS=<<parameters.os>>
        SCANNER_DIRECTORY=scanner

        mkdir -p $SCANNER_DIRECTORY
        curl -Ol https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-$VERSION-$OS.zip
        unzip -q -o sonar-scanner-cli-$VERSION-$OS.zip -d $SCANNER_DIRECTORY
        
        chmod +x $SCANNER_DIRECTORY/sonar-scanner-$VERSION-$OS/bin/sonar-scanner
        chmod +x $SCANNER_DIRECTORY/sonar-scanner-$VERSION-$OS/jre/bin/java

        $SCANNER_DIRECTORY/sonar-scanner-$VERSION-$OS/bin/sonar-scanner
      environment:
        SONARQUBE_SCANNER_PARAMS: '{"sonar.host.url":"https://sonarcloud.io"}'